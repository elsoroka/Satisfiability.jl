<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advanced usage · Satisfiability.jl</title><meta name="title" content="Advanced usage · Satisfiability.jl"/><meta property="og:title" content="Advanced usage · Satisfiability.jl"/><meta property="twitter:title" content="Advanced usage · Satisfiability.jl"/><meta name="description" content="Documentation for Satisfiability.jl."/><meta property="og:description" content="Documentation for Satisfiability.jl."/><meta property="twitter:description" content="Documentation for Satisfiability.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Satisfiability.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Solving SMT Problems in Julia</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../interactive/">Interactive solving</a></li><li><a class="tocitem" href="../example_uninterpreted_func/">Uninterpreted Functions</a></li><li class="is-active"><a class="tocitem" href>Advanced usage</a><ul class="internal"><li><a class="tocitem" href="#Custom-solver-options-and-using-other-solvers-(Experimental)"><span>Custom solver options and using other solvers (Experimental)</span></a></li><li><a class="tocitem" href="#Setting-the-solver-logic"><span>Setting the solver logic</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../faq/">FAQ</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example_scheduling/">Finding a meeting time</a></li><li><a class="tocitem" href="../example_job_shop/">Job shop scheduling</a></li><li><a class="tocitem" href="../example_bv_mini/">BitVectors</a></li><li><a class="tocitem" href="../example_bv_lcg/">Predicting the output of a tiny LCG</a></li><li><a class="tocitem" href="../example_graph_coloring/">Graph coloring</a></li><li><a class="tocitem" href="../example_bad_assertions/">Pushing and popping assertions</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../functions/">Functions</a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../release_notes/">Release Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Advanced usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Advanced usage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/elsoroka/Satisfiability.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/elsoroka/Satisfiability.jl/blob/main/docs/src/advanced.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Advanced-usage"><a class="docs-heading-anchor" href="#Advanced-usage">Advanced usage</a><a id="Advanced-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-usage" title="Permalink"></a></h1><ul><li><a href="#Advanced-usage">Advanced usage</a></li><li class="no-marker"><ul><li><a href="#Custom-solver-options-and-using-other-solvers-(Experimental)">Custom solver options and using other solvers (Experimental)</a></li><li class="no-marker"><ul><li><a href="#Debugging-tips">Debugging tips</a></li><li><a href="#Open-an-issue!">Open an issue!</a></li><li><a href="#Known-issue:-CVC4-doesn&#39;t-work!">Known issue: CVC4 doesn&#39;t work!</a></li></ul></li><li><a href="#Setting-the-solver-logic">Setting the solver logic</a></li><li class="no-marker"><ul><li><a href="#Custom-interactions-using-send_command">Custom interactions using <code>send_command</code></a></li></ul></li></ul></li></ul><p>Note: Some of the options described on this page require you to use the SMTLIB2 specification language directly.</p><h2 id="Custom-solver-options-and-using-other-solvers-(Experimental)"><a class="docs-heading-anchor" href="#Custom-solver-options-and-using-other-solvers-(Experimental)">Custom solver options and using other solvers (Experimental)</a><a id="Custom-solver-options-and-using-other-solvers-(Experimental)-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-solver-options-and-using-other-solvers-(Experimental)" title="Permalink"></a></h2><p>In theory, you can call any SMTLIB2 compliant solver using its <strong>interactive</strong> command-line interface. In practice, this can be tricky and this feature is considered experimental.</p><p>To customize solver options or use a different (unsupported) solver, use the syntax</p><pre><code class="language-julia hljs">solver = Solver(&quot;My Solver&quot;, `program_name --option1 --option2`)
sat!(problem, solver=solver) # sat! will use your provided command to invoke the solver</code></pre><p>The command you provide must launch a solver that accepts SMTLIB2-formatted commands and can respond to <code>(get-model)</code> in SAT mode. (An example of a command that does NOT work is <code>cvc5 --interactive</code>, because <code>CVC5</code> cannot answer <code>(get-model)</code> without the <code>--produce-models</code> option.)</p><h3 id="Debugging-tips"><a class="docs-heading-anchor" href="#Debugging-tips">Debugging tips</a><a id="Debugging-tips-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-tips" title="Permalink"></a></h3><ul><li>To troubleshoot your custom solver, you can use <code>print(smt(expr))</code> to print the SMT commands for your problem, call the solver from your own command-line and paste in the contents of your SMT file. Then issue the commands <code>(check-sat)</code> and, if satisfiable, <code>(get-model)</code>. This is exactly what Satisfiability.jl does when you call  <code>sat!</code>.</li><li>Open your custom solver in interactive mode, try to solve the problem and then check its <code>command_history</code>. This is a list of all the commands sent to the solver. You can open an instance of the solver in your command line and paste in the commands to see the output for yourself. Look out for warnings and errors printed by the solver, which often cause output parsing errors.</li><li>Startup messages and command prompts cause output parsing errors. Example: <code>cvc4 --lang smt2 --interactive --produce-models --incremental</code> prints both a startup message and a <code>CVC4&gt;</code> command prompt that confuse our parser. Compare this to <code>cvc4 --interactive --produce-models --incremental --no-interactive-prompt</code> which doesn&#39;t include a command prompt or startup message. (However, CVC4 doesn&#39;t work for another reason discussed below.)</li><li>The solver should produce models or <code>sat!</code> won&#39;t work. The command <code>(get-model)</code> is issued internally when a problem is satisfiable.</li></ul><h3 id="Open-an-issue!"><a class="docs-heading-anchor" href="#Open-an-issue!">Open an issue!</a><a id="Open-an-issue!-1"></a><a class="docs-heading-anchor-permalink" href="#Open-an-issue!" title="Permalink"></a></h3><p>We want Satisfiability.jl to be compatible with more solvers and are interested in investigating these issues. Please attach a minimum working example of your code and mention what OS you&#39;re on and how you installed the solver.</p><h3 id="Known-issue:-CVC4-doesn&#39;t-work!"><a class="docs-heading-anchor" href="#Known-issue:-CVC4-doesn&#39;t-work!">Known issue: CVC4 doesn&#39;t work!</a><a id="Known-issue:-CVC4-doesn&#39;t-work!-1"></a><a class="docs-heading-anchor-permalink" href="#Known-issue:-CVC4-doesn&#39;t-work!" title="Permalink"></a></h3><p>We are not aware of a way to make CVC4 work with Satisfiability.jl because CVC4 echoes the input to the output (see <a href="https://github.com/elsoroka/Satisfiability.jl/issues/57">issue #57</a>). CVC5 doesn&#39;t do this and works well. If you have a suggestion to get around this behvaior, please let us know.</p><h2 id="Setting-the-solver-logic"><a class="docs-heading-anchor" href="#Setting-the-solver-logic">Setting the solver logic</a><a id="Setting-the-solver-logic-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-the-solver-logic" title="Permalink"></a></h2><p>You can set the solver logic using an optional keyword argument in <code>sat!</code>. The solver logic must be a string corresponding to a <a href="http://smtlib.cs.uiowa.edu/logics.shtml">valid SMT-LIB logic</a>. Users are responsible for selecting a logic that reflects the problem they intend to solve - Satisfiability.jl does not perform any correctness checking. Here&#39;s an example for Yices, which <strong>requires</strong> the user to set the solver logic (some other solvers, such as Z3 and CVC5, will automatically infer a suitable logic if one isn&#39;t explicitly set).</p><pre><code class="language-julia hljs">status = sat!(expr, solver=Yices(), logic=&quot;QF_UFLIA&quot;)</code></pre><h3 id="Custom-interactions-using-send_command"><a class="docs-heading-anchor" href="#Custom-interactions-using-send_command">Custom interactions using <code>send_command</code></a><a id="Custom-interactions-using-send_command-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-interactions-using-send_command" title="Permalink"></a></h3><p>Satisfiability.jl provides an interface to issue SMT-LIB commands and receive SMT-LIB-formatted solver responses programmatically. This is useful if you wish to build your own decision logic or parser using advanced solver functionality.</p><p>If you just want to use an SMT solver interactively, for example by <code>push</code>ing or <code>pop</code>ping assertions, check out <a href="../interactive/">Interactive Solving</a>.</p><p>!!! note SMT-LIB solver modes.</p><p>In the SMT-LIB specification, after entering a problem and issuing the command <code>(check-sat)</code> the solver will be in either <code>sat</code> or <code>unsat</code> mode. The solver mode determines which commands are valid: for example, <code>(get-unsat-core)</code> is only valid in <code>unsat</code> mode and <code>(get-model)</code> is only valid in <code>sat</code> mode. You can find descriptions of modes and listings of valid commands in the latest <a href="http://www.smtlib.org/">SMT-LIB Standard</a>.</p><p>Here&#39;s an example.</p><pre><code class="language-julia hljs">using Satisfiability
@satvariable(x[1:2], Bool)
expr = (x[1] ∧ ¬x[1]) ∧ or(x) # unsat

interactive_solver = open(Z3())

send_command(interactive_solver, &quot;(set-option :produce-unsat-cores true)&quot;, dont_wait=true)

# smt() adds the command (check-sat), so Z3 will be in either `sat` or `unsat` mode after this command.
input = smt(expr)*&quot;\n(check-sat)\n&quot;
response = send_command(interactive_solver, input, is_done=is_sat_or_unsat)

println(&quot;status = $response&quot;) # &quot;unsat&quot;

response = send_command(interactive_solver, &quot;(get-unsat-core)&quot;, is_done=nested_parens_match)
println(response)

# more interactions via `send_command`...

# it&#39;s good form to clean up your open solver process
close(interactive_solver)</code></pre><p>When using this functionality, you are responsible for keeping track of the solver mode and parsing the result of <code>send_command</code>. For convenience, <code>parse_model(model::String)</code> can parse the result of the SMT-LIB command <code>(get-model)</code>, returning a dictionary with variable names as keys and satisfying assignments as values.</p><p><strong>Checking if the response is complete</strong> Receiving a complete solver response is not as simple as it sounds, for two reasons.</p><ol><li>The solver may take a long time to respond, for example when calling <code>(check-sat)</code>.</li><li>The solver&#39;s response may be large, thus it may be received in several chunks.</li></ol><p>The <code>send_command</code> function has an optional argument <code>is_done</code> for checking whether the full response has been received. Two convenience functions are provided: <code>nested_parens_match(response::String)</code> returns <code>true</code> if <code>response</code> begins with <code>(</code> and ends with a matching <code>)</code>. This ensures the entire output is returned when issuing commands such as <code>(get-model)</code> where the entire response is wrapped in 1 set of parentheses. Many solver responses follow this format. <code>is_sat_or_unsat</code> is very simple: if the response contains <code>sat</code> or <code>unsat</code> it returns <code>true</code>, otherwise it&#39;s <code>false</code>.</p><p>!!! warning Multiple parenthesized statements</p><p>If your command produces a response with multiple separate statements, for example <code>(statement_1)\n(statement_2)</code>, <code>nested_parens_match</code> is not guaranteed to return the entire response. The intended use case is <code>((statement_1)\n(statement_2))</code>. This should only happen if you issue two SMT-LIB commands at once.</p><p><strong>Customizing <code>is_done</code></strong></p><p>A custom function <code>is_done(response::String)::Bool</code>, should have the following behavior:</p><ul><li><code>is_done</code> returns <code>true</code> if the given <code>response</code> is valid (in whatever sense you define) and <code>false</code> if not.</li><li><code>send_command</code> will WAIT for more output while <code>is_done</code> is false.</li></ul><p>SAT solvers can be slow and some commands produce long outputs. Without <code>is_done</code>, <code>send_command</code> could receive a partial response and prematurely return.</p><p>For full implementation details, please see the <a href="https://github.com/elsoroka/Satisfiability.jl/blob/main/src/call_solver.jl">source code</a> of <code>call_solver.jl</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_uninterpreted_func/">« Uninterpreted Functions</a><a class="docs-footer-nextpage" href="../faq/">FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Monday 26 August 2024 14:52">Monday 26 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
